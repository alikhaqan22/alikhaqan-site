<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ali Khaqan - Interactive Portfolio Game</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Courier New',monospace;background:#5C94FC;overflow:hidden}
  .game-screen{width:100vw;height:100vh;position:relative;background:linear-gradient(180deg,#5C94FC 0%,#87CEEB 50%,#98FB98 100%);overflow:hidden}
  .game-world{position:absolute;width:1600px;height:1000px;background:linear-gradient(180deg,#5C94FC 0%,#87CEEB 30%,#98FB98 60%,#32CD32 100%);transition:transform .1s ease}

  /* Clouds */
  .cloud{position:absolute;background:#fff;border-radius:50px;animation:cloudFloat 20s linear infinite}
  .cloud1{width:80px;height:40px;top:5%;left:10%}
  .cloud2{width:100px;height:50px;top:8%;left:40%;animation-delay:-5s}
  .cloud3{width:70px;height:35px;top:12%;left:70%;animation-delay:-10s}
  .cloud4{width:90px;height:45px;top:6%;left:85%;animation-delay:-15s}
  @keyframes cloudFloat{0%{transform:translateX(0)}100%{transform:translateX(-100px)}}

  /* Blocks / pipes / bushes / trees (solid) */
  .brick-block,.pipe,.bush,.mario-tree,.tree{pointer-events:none}
  .brick-block{position:absolute;width:40px;height:40px;background:#D2691E;border:2px solid #8B4513;
    background-image:linear-gradient(45deg,#CD853F 25%,transparent 25%),linear-gradient(-45deg,#CD853F 25%,transparent 25%),linear-gradient(45deg,transparent 75%,#CD853F 75%),linear-gradient(-45deg,transparent 75%,#CD853F 75%);
    background-size:8px 8px}
  .question-block{position:absolute;width:40px;height:40px;background:#FFD700;border:2px solid #FFA500;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:bold;color:#FF8C00;animation:questionPulse 1.5s ease-in-out infinite}
  .question-block.interactive-object{pointer-events:auto;cursor:pointer;filter:drop-shadow(0 0 10px rgba(255,255,255,.6))}
  @keyframes questionPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
  .pipe{position:absolute;background:#228B22;border:3px solid #006400;border-radius:15px 15px 0 0}
  .pipe-small{width:60px;height:80px}.pipe-medium{width:60px;height:120px}.pipe-large{width:60px;height:160px}
  .pipe::before{content:'';position:absolute;top:-8px;left:-8px;right:-8px;height:20px;background:#228B22;border:3px solid #006400;border-radius:8px}
  .bush{position:absolute;width:80px;height:40px;background:#228B22;border-radius:40px;border:2px solid #006400}
  .bush::before{content:'';position:absolute;left:20px;top:-15px;width:40px;height:30px;background:#228B22;border-radius:20px;border:2px solid #006400}
  .mario-tree{position:absolute;width:20px;height:60px;background:#8B4513;border:2px solid #654321}
  .mario-tree::before{content:'';position:absolute;top:-30px;left:50%;transform:translateX(-50%);width:60px;height:50px;background:#228B22;border-radius:50%;border:2px solid #006400}

  /* Coins */
  .coin{position:absolute;width:25px;height:25px;background:#FFD700;border:2px solid #FFA500;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:bold;color:#FF8C00;animation:coinSpin 2s linear infinite}
  @keyframes coinSpin{0%{transform:rotateY(0)}100%{transform:rotateY(360deg)}}

  /* Goombas (hazard) */
  .goomba{position:absolute;width:30px;height:30px;background:#8B4513;border-radius:50% 50% 0 0;border:2px solid #654321;animation:goombaWalk 3s ease-in-out infinite;pointer-events:none}
  .goomba::before{content:'‚Ä¢ ‚Ä¢';position:absolute;top:8px;left:50%;transform:translateX(-50%);font-size:10px;color:#000}
  @keyframes goombaWalk{0%,100%{transform:translateX(0)}50%{transform:translateX(20px)}}

  /* Flowers */
  .super-flower{position:absolute;width:30px;height:40px;animation:flowerSway 3s ease-in-out infinite}
  .super-flower::before{content:'üå∏';font-size:25px;position:absolute;top:0;left:0}
  @keyframes flowerSway{0%,100%{transform:rotate(0)}50%{transform:rotate(10deg)}}

  /* UI Overlay + safe area */
  .ui-overlay{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;padding-top:env(safe-area-inset-top)}
  .ui-header{position:absolute;top:calc(14px + env(safe-area-inset-top));left:14px;color:#fff;text-shadow:3px 3px 0 #000;pointer-events:all;max-width:75vw}
  .ui-title{font-size:2rem;font-weight:bold;margin-bottom:4px;line-height:1.1}
  .ui-subtitle{font-size:1.1rem;opacity:.9;line-height:1.1;word-break:break-word}

  .menu-buttons{position:absolute;top:20px;right:20px;display:flex;gap:15px;pointer-events:all}
  .menu-btn{background:#4169E1;color:#fff;border:3px solid #fff;padding:12px 20px;font-family:'Courier New',monospace;font-size:1rem;font-weight:bold;cursor:pointer;border-radius:8px;transition:.2s}
  .menu-btn:hover{background:#FF6B35;transform:scale(1.05)}

  /* Character */
  .character{position:absolute;width:40px;height:48px;z-index:100}
  .character-body{width:100%;height:100%;background:linear-gradient(180deg,#FFE4B5 0,#FFE4B5 40%,#4169E1 40%,#4169E1 70%,#0000FF 70%,#0000FF 100%);border:2px solid #000;border-radius:20px 20px 8px 8px;position:relative}
  .character-face{position:absolute;top:8px;left:50%;transform:translateX(-50%)}
  .character-eyes{width:4px;height:4px;background:#000;border-radius:50%;position:relative}
  .character-eyes::after{content:'';position:absolute;left:8px;top:0;width:4px;height:4px;background:#000;border-radius:50%}
  .character-mouth{position:absolute;top:10px;left:50%;transform:translateX(-50%);width:6px;height:3px;background:#000;border-radius:0 0 6px 6px}
  .character-hat{position:absolute;top:-5px;left:50%;transform:translateX(-50%);width:30px;height:15px;background:#4169E1;border-radius:15px 15px 0 0;border:2px solid #000}

  /* Dialogue / Modals */
  .dialogue-box{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);width:85%;max-width:700px;background:rgba(255,255,255,.95);border:4px solid #000;border-radius:15px;padding:25px;font-size:1.1rem;z-index:200;display:none;pointer-events:all;box-shadow:0 10px 30px rgba(0,0,0,.5)}
  .dialogue-box.active{display:block;animation:slideUp .3s ease}
  .dialogue-close{position:absolute;top:8px;right:10px;width:32px;height:32px;border:none;border-radius:8px;background:#eee;cursor:pointer;font-weight:bold;font-size:1.2rem;line-height:1}
  .dialogue-close:hover{background:#ffd8d8}
  @keyframes slideUp{from{transform:translateX(-50%) translateY(100px);opacity:0}to{transform:translateX(-50%) translateY(0);opacity:1}}
  .dialogue-text{margin-bottom:20px;line-height:1.5;color:#333}
  .dialogue-options{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}
  .dialogue-option{background:#32CD32;color:#fff;border:3px solid #228B22;padding:12px 20px;border-radius:8px;cursor:pointer;font-family:'Courier New',monospace;font-weight:bold;transition:.2s}
  .dialogue-option:hover{background:#FF6B35;border-color:#D2691E;transform:scale(1.05)}

  .interactive-object{position:absolute;cursor:pointer;transition:.2s;filter:drop-shadow(0 0 10px rgba(255,255,255,.7))}
  .interactive-object:hover{transform:scale(1.1);filter:drop-shadow(0 0 20px rgba(255,255,0,1))}
  .computer{width:50px;height:40px;background:#696969;border:3px solid #000;border-radius:8px;position:relative}
  .computer::before{content:'üíª';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:24px}

  /* Social icons */
  .social-icon{width:45px;height:45px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;color:#fff;font-weight:bold;border:3px solid #fff;position:relative}
  .social-icon::after{content:attr(data-name);position:absolute;bottom:-22px;left:50%;transform:translateX(-50%);font-size:10px;color:#fff;text-shadow:1px 1px 0 #000;white-space:nowrap}
  .instagram{background:linear-gradient(45deg,#f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%)}
  .tiktok{background:linear-gradient(45deg,#000,#ff0050)}
  .linkedin{background:linear-gradient(45deg,#0077b5,#00a0dc)}
  .tree{width:25px;height:60px;background:#8B4513;position:relative;border-radius:0 0 8px 8px}
  .tree::before{content:'üå≥';position:absolute;top:-35px;left:50%;transform:translateX(-50%);font-size:40px}

  .controls-help{position:absolute;bottom:20px;right:20px;background:rgba(0,0,0,.8);color:#fff;padding:20px;border-radius:12px;font-size:1rem;pointer-events:all;border:2px solid #4169E1}
  .mobile-controls{position:fixed;bottom:calc(16px + env(safe-area-inset-bottom));left:16px;display:none;pointer-events:all;z-index:1001}
  .mobile-dpad{position:relative;width:140px;height:140px}
  .mobile-btn{position:absolute;width:56px;height:56px;background:rgba(65,105,225,.9);border:2px solid #fff;border-radius:10px;color:#fff;font-size:20px;font-weight:bold;cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:center;touch-action:none}
  .mobile-btn:active{background:rgba(255,107,53,.9);transform:scale(.95)}
  .btn-up{top:0;left:42px}.btn-down{bottom:0;left:42px}.btn-left{top:42px;left:0}.btn-right{top:42px;right:0}

  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;display:none;align-items:center;justify-content:center;pointer-events:all}
  .modal.active{display:flex;animation:fadeIn .3s ease}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  .modal-content{background:#fff;max-width:90%;max-height:90%;overflow-y:auto;border-radius:15px;position:relative;border:4px solid #4169E1}
  .modal-close{position:absolute;top:15px;right:20px;font-size:2rem;cursor:pointer;color:#999;z-index:1001;background:#fff;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border:2px solid #ddd}
  .modal-close:hover{color:#ff4444;background:#ffeeee}
  .cv-content,.about-content{padding:50px;font-family:Arial,sans-serif;line-height:1.8;font-size:1.05rem}
  .cv-header{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:3px solid #4169E1}
  .cv-section{margin-bottom:25px;padding:20px;background:rgba(65,105,225,.05);border-radius:10px;border-left:5px solid #4169E1}
  .cv-section h3{color:#4169E1;font-size:1.25rem;margin-bottom:10px}
  .experience-item{margin-bottom:15px;padding:15px;background:#fff;border-radius:8px;border:1px solid #ddd}

  /* HUD coin counter */
  .hud{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.6);color:#fff;border:2px solid #fff;border-radius:10px;padding:8px 14px;pointer-events:all;z-index:1001}

  @media (max-width:768px){
    .ui-header{top:calc(10px + env(safe-area-inset-top));left:12px;max-width:70vw}
    .ui-title{font-size:1.3rem}
    .ui-subtitle{font-size:.95rem}
    .menu-buttons{
      top:auto;right:16px;left:auto;
      bottom:calc(16px + env(safe-area-inset-bottom));
      transform:none;gap:10px;z-index:1002;
      flex-direction:column;
    }
    .menu-btn{font-size:1rem;padding:12px 14px}
    .hud{top:calc(10px + env(safe-area-inset-top));right:12px;left:auto;transform:none}
    .mobile-controls{display:block}
    .controls-help{display:none}
    .dialogue-box{width:95%;font-size:1rem;padding:20px;bottom:calc(80px + env(safe-area-inset-bottom))}
    .cv-content,.about-content{padding:25px}
  }
</style>
</head>
<body>
  <div class="game-screen">
    <div class="game-world" id="gameWorld">
      <!-- clouds -->
      <div class="cloud cloud1"></div><div class="cloud cloud2"></div><div class="cloud cloud3"></div><div class="cloud cloud4"></div>

      <!-- blocks row -->
      <div class="brick-block" style="left:200px;top:400px"></div>
      <div class="brick-block" style="left:240px;top:400px"></div>
      <div class="brick-block" style="left:280px;top:400px"></div>

      <!-- fun fact 1 -->
      <div class="question-block interactive-object" data-type="fun" data-fact="1" style="left:320px;top:360px">?</div>

      <div class="brick-block" style="left:360px;top:400px"></div>

      <!-- second group -->
      <div class="brick-block" style="left:800px;top:500px"></div>
      <!-- fun fact 2 -->
      <div class="question-block interactive-object" data-type="fun" data-fact="2" style="left:840px;top:460px">?</div>
      <div class="brick-block" style="left:880px;top:500px"></div>

      <!-- pipes -->
      <div class="pipe pipe-small" style="left:150px;top:650px"></div>
      <div class="pipe pipe-medium" style="left:600px;top:610px"></div>
      <div class="pipe pipe-large" style="left:1100px;top:570px"></div>

      <!-- bushes/trees -->
      <div class="bush" style="left:100px;top:680px"></div>
      <div class="bush" style="left:400px;top:680px"></div>
      <div class="bush" style="left:900px;top:680px"></div>
      <div class="mario-tree" style="left:50px;top:640px"></div>
      <div class="mario-tree" style="left:750px;top:640px"></div>
      <div class="mario-tree" style="left:1200px;top:640px"></div>

      <!-- coins -->
      <div class="coin" style="left:250px;top:300px">‚Ç¨</div>
      <div class="coin" style="left:300px;top:250px">‚Ç¨</div>
      <div class="coin" style="left:350px;top:300px">‚Ç¨</div>
      <div class="coin" style="left:650px;top:400px">‚Ç¨</div>
      <div class="coin" style="left:950px;top:350px">‚Ç¨</div>

      <!-- goombas (hazards) -->
      <div class="goomba" style="left:500px;top:670px"></div>
      <div class="goomba" style="left:1000px;top:670px"></div>

      <!-- flowers -->
      <div class="super-flower" style="left:80px;top:600px"></div>
      <div class="super-flower" style="left:450px;top:600px"></div>
      <div class="super-flower" style="left:800px;top:600px"></div>
      <div class="super-flower" style="left:1150px;top:600px"></div>

      <!-- Character -->
      <div class="character" id="character" style="left:300px;top:500px">
        <div class="character-hat"></div>
        <div class="character-body">
          <div class="character-face">
            <div class="character-eyes"></div>
            <div class="character-mouth"></div>
          </div>
        </div>
      </div>

      <!-- Interactive Objects -->
      <div class="interactive-object computer" id="cvComputer" style="left:400px;top:300px" data-type="cv" title="Open CV"></div>

      <!-- Social media totems (with SVG icons) -->
      <div class="social-media-zone" style="position:absolute;left:950px;top:150px;width:200px">
        <a class="interactive-object social-icon instagram" data-type="social" data-platform="instagram" data-name="INSTAGRAM" aria-label="Instagram" style="position:relative;left:0;top:0;margin-bottom:20px">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white" aria-hidden="true">
            <path d="M12 2.2c3.2 0 3.6.01 4.9.07 3.2.15 4.77 1.69 4.92 4.92.06 1.26.07 1.65.07 4.9s-.01 3.64-.07 4.9c-.15 3.22-1.67 4.77-4.92 4.92-1.26.06-1.65.07-4.9.07s-3.64-.01-4.9-.07c-3.22-.15-4.77-1.67-4.92-4.92C2.2 15.64 2.2 15.25 2.2 12s.01-3.64.07-4.9C2.42 3.88 3.94 2.35 7.18 2.2 8.44 2.14 8.83 2.13 12 2.13V2.2zM12 5.84A6.16 6.16 0 1 0 18.16 12 6.16 6.16 0 0 0 12 5.84zm0 10.16A4 4 0 1 1 16 12a4 4 0 0 1-4 4zm6.41-11.84a1.44 1.44 0 1 0 1.44 1.44 1.44 1.44 0 0 0-1.44-1.44z"/>
          </svg>
        </a>
        <a class="interactive-object social-icon tiktok" data-type="social" data-platform="tiktok" data-name="TIKTOK" aria-label="TikTok" style="position:relative;left:60px;top:-65px;margin-bottom:20px">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white" aria-hidden="true">
            <path d="M19.6 6.7a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 1 1-2.89-2.89c.31 0 .6.05.88.13V9.4c-.29-.03-.59-.05-.88-.05A6.33 6.33 0 1 0 16 15.67v-7a8.16 8.16 0 0 0 4.77 1.52V6.79c-.34-.03-.76-.08-1.17-.09z"/>
          </svg>
        </a>
        <a class="interactive-object social-icon linkedin" data-type="social" data-platform="linkedin" data-name="LINKEDIN" aria-label="LinkedIn" style="position:relative;left:120px;top:-130px;margin-bottom:20px">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white" aria-hidden="true">
            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433A2.063 2.063 0 1 1 7.4 5.368a2.063 2.063 0 0 1-2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452z"/>
          </svg>
        </a>
      </div>

      <!-- About tree -->
      <div class="interactive-object tree" id="aboutTree" style="left:1000px;top:500px" data-type="about" title="About Ali"></div>
    </div>

    <!-- UI overlay -->
    <div class="ui-overlay">
      <div class="ui-header">
        <div class="ui-title">ALI KHAQAN</div>
        <div class="ui-subtitle">STRATEGIC PORTFOLIO WORLD</div>
      </div>

      <!-- HUD coin counter -->
      <div class="hud" id="coinHud">Coins: <span id="coinCount">0</span></div>

      <div class="menu-buttons">
        <button class="menu-btn" id="menuBtn">üìã MENU</button>
        <button class="menu-btn" id="mapBtn">‚ùì HELP</button>
      </div>

      <div class="controls-help" id="controlsHelp">
        <div><strong>üéÆ CONTROLS:</strong></div>
        <div><strong>Arrow Keys ‚Üê‚Üë‚Üì‚Üí</strong> - Move around</div>
        <div><strong>Click objects</strong> - Interact</div>
        <div><strong>ESC</strong> - Close windows</div>
        <div><strong>üí° Tip:</strong> Get close for easier interaction!</div>
      </div>

      <!-- Mobile controls -->
      <div class="mobile-controls" id="mobileControls">
        <div class="mobile-dpad">
          <div class="mobile-btn btn-up" data-direction="up">‚Üë</div>
          <div class="mobile-btn btn-down" data-direction="down">‚Üì</div>
          <div class="mobile-btn btn-left" data-direction="left">‚Üê</div>
          <div class="mobile-btn btn-right" data-direction="right">‚Üí</div>
        </div>
      </div>
    </div>

    <!-- Dialogue -->
    <div class="dialogue-box" id="dialogueBox">
      <button class="dialogue-close" onclick="closeDialogue()">√ó</button>
      <div class="dialogue-text" id="dialogueText"></div>
      <div class="dialogue-options" id="dialogueOptions"></div>
    </div>
  </div>

  <!-- CV Modal -->
  <div class="modal" id="cvModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('cvModal')">&times;</span>
      <div class="cv-content">
        <div class="cv-header">
          <img src="IMG_8843.jpg" alt="Ali Khaqan" style="width:120px;height:120px;border-radius:50%;object-fit:cover;border:3px solid #4169E1;margin-bottom:10px;">
          <h1>Ali Khaqan</h1>
          <h2>Strategic Management | ESG, AI & Analytics</h2>
          <p>üìß <a href="mailto:alikhaqan22@gmail.com">alikhaqan22@gmail.com</a> | üì± +49 176 7619 4593 | üìç K√ºnzelsau, Germany</p>
          <p>üåê LinkedIn: <a href="https://www.linkedin.com/in/ali-khaqan/" target="_blank" rel="noopener">linkedin.com/in/ali-khaqan</a> | üì∏ Instagram: <a href="https://instagram.com/itsalikhaqan" target="_blank" rel="noopener">@itsalikhaqan</a> | üéµ TikTok: <a href="https://tiktok.com/@itsalikhaqan" target="_blank" rel="noopener">@itsalikhaqan</a></p>
          <p><strong>Status:</strong> Pakistani with German PR (Niederlassungserlaubnis)</p>
          <p><strong>Languages:</strong> English (Fluent), German (B1 ‚Äî improving thanks to my wife, a native German speaker)</p>
          <p><a href="Ali_CV_2025.pdf" download>‚¨áÔ∏è Download full CV (PDF)</a></p>
        </div>
        <div class="cv-section">
          <h3>üéØ Professional Summary</h3>
          <p>I work at the crossroads of ESG, AI, and compliance ‚Äî helping connect big-picture strategy with execution in manufacturing and automotive electronics. My focus is on turning complex challenges into clear results, building strong teams, and driving sustainable growth. Outside of work, I share my journey as an international living in Germany ‚Äî from gym routines to daily habits ‚Äî showing how discipline, balance, and consistency shape both professional and personal success.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="modal" id="aboutModal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal('aboutModal')">&times;</span>
      <div class="about-content">
        <h2 style="margin-bottom:10px;color:#4169E1">About Ali</h2>
        <p>Hey! I‚Äôm Ali Khaqan ‚Äî a strategy-minded operator working at the intersection of leadership, ESG, analytics, and product execution. Outside work I‚Äôm a gym enthusiast and create content aimed at <strong>motivating teens and students</strong> to build strong habits. I share simple training tips, routines, and mindset notes on Instagram/TikTok to help kids start smart and stay consistent.</p>
        <p>I love mentoring, simplifying complex topics, and turning ideas into systems. If you‚Äôd like advice on breaking into tech/ops, building a training routine, or navigating early career choices ‚Äî reach out!</p>
        <p style="margin-top:10px">üìß <a href="mailto:alikhaqan22@gmail.com">alikhaqan22@gmail.com</a> ¬∑ üí¨ <a href="https://instagram.com/itsalikhaqan" target="_blank" rel="noopener">@itsalikhaqan</a></p>
      </div>
    </div>
  </div>

<script>
/* ====================== GAME STATE ====================== */
const START_POS = { x:300, y:500 };

let gameState = {
  character: { x:START_POS.x, y:START_POS.y, speed:6.5 },
  camera: { x:0, y:0 },
  world: { width:1600, height:1000 },
  screen: { width:window.innerWidth, height:window.innerHeight },
  keys: {},
  dialogueActive:false,
  coins:0
};

/* ====================== INIT ====================== */
document.addEventListener('DOMContentLoaded', () => {
  gameState.screen.width = window.innerWidth;
  gameState.screen.height = window.innerHeight;

  // Keyboard
  document.addEventListener('keydown', handleKeyDown);
  document.addEventListener('keyup', handleKeyUp);

  // Menu & Help
  document.getElementById('menuBtn').addEventListener('click', showMenu);
  document.getElementById('mapBtn').addEventListener('click', showHelp);

  // Resize
  window.addEventListener('resize', () => {
    gameState.screen.width = window.innerWidth;
    gameState.screen.height = window.innerHeight;
  });

  // ===== Mobile controls: continuous movement while pressed =====
  let holdTimer = null;
  let holdDir = null;

  function startHold(dir){
    stopHold();
    holdDir = dir;
    holdTimer = setInterval(()=> moveCharacter(holdDir, /*isHold=*/true), 16); // ~60fps
  }
  function stopHold(){
    if (holdTimer){ clearInterval(holdTimer); holdTimer = null; holdDir = null; }
  }

  document.querySelectorAll('.mobile-btn').forEach(btn=>{
    const dir = btn.dataset.direction;

    // Touch
    btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); startHold(dir); }, {passive:false});
    btn.addEventListener('touchend',   (e)=>{ e.preventDefault(); stopHold();   }, {passive:false});
    btn.addEventListener('touchcancel',(e)=>{ e.preventDefault(); stopHold();   }, {passive:false});

    // Mouse (desktop testing)
    btn.addEventListener('mousedown', (e)=>{ e.preventDefault(); startHold(dir); });
    ['mouseup','mouseleave'].forEach(ev=> btn.addEventListener(ev, ()=> stopHold()));
  });

  // Interactive objects
  document.querySelectorAll('.interactive-object').forEach(obj=>{
    obj.addEventListener('click', handleObjectClick);
  });

  // Start loop
  updateCamera();
  requestAnimationFrame(gameLoop);
});

/* ====================== INPUT ====================== */
function handleKeyDown(e){
  gameState.keys[e.key] = true;
  if(e.key==='Escape') closeAllModals();
}
function handleKeyUp(e){ gameState.keys[e.key] = false; }

/* ====================== COLLISION HELPERS ====================== */
function rect(el){ return el.getBoundingClientRect(); }
function isOverlapById(id, el2){
  const r1 = rect(document.getElementById(id));
  const r2 = rect(el2);
  return !(r1.right<r2.left || r1.left>r2.right || r1.bottom<r2.top || r1.top>r2.bottom);
}
function collidesWithSolids(){
  const solids = document.querySelectorAll('.pipe,.brick-block,.bush,.mario-tree,.tree,.goomba');
  for (const el of solids){ if (isOverlapById('character', el)) return true; }
  return false;
}

/* ====================== MOVEMENT (axis-separated) ====================== */
function applyAxisMovement(dx, dy){
  const c = gameState.character;
  const oldX = c.x, oldY = c.y;

  // move X first
  c.x = Math.min(gameState.world.width-40, Math.max(0, c.x + dx));
  updateCharacterPosition();
  if (collidesWithSolids()){ c.x = oldX; updateCharacterPosition(); }

  // then move Y
  c.y = Math.min(gameState.world.height-48, Math.max(0, c.y + dy));
  updateCharacterPosition();
  if (collidesWithSolids()){ c.y = oldY; updateCharacterPosition(); }

  updateCamera();
  checkHazard();
  checkCoinPickup();
}

function updateCharacter(){
  if (gameState.dialogueActive) return;

  let dx = 0, dy = 0;
  const s = gameState.character.speed;

  if (gameState.keys['ArrowLeft']||gameState.keys['a']||gameState.keys['A']) dx -= s;
  if (gameState.keys['ArrowRight']||gameState.keys['d']||gameState.keys['D']) dx += s;
  if (gameState.keys['ArrowUp']||gameState.keys['w']||gameState.keys['W']) dy -= s;
  if (gameState.keys['ArrowDown']||gameState.keys['s']||gameState.keys['S']) dy += s;

  if (dx||dy) applyAxisMovement(dx, dy);
}

function moveCharacter(direction, isHold=false){
  if (gameState.dialogueActive) return;

  const step = (isHold ? gameState.character.speed*2.2 : gameState.character.speed*1.6);
  let dx=0, dy=0;
  if(direction==='left')  dx -= step;
  if(direction==='right') dx += step;
  if(direction==='up')    dy -= step;
  if(direction==='down')  dy += step;

  applyAxisMovement(dx, dy);
}

/* ====================== CAMERA & POSITION ====================== */
function updateCharacterPosition(){
  const el = document.getElementById('character');
  el.style.left = gameState.character.x + 'px';
  el.style.top  = gameState.character.y + 'px';
}
function updateCamera(){
  const c = gameState.character, s = gameState.screen;
  gameState.camera.x = Math.max(0, Math.min(gameState.world.width - s.width,  c.x - s.width/2));
  gameState.camera.y = Math.max(0, Math.min(gameState.world.height - s.height, c.y - s.height/2));
  document.getElementById('gameWorld').style.transform = `translate(-${gameState.camera.x}px, -${gameState.camera.y}px)`;
}

/* ====================== INTERACTION ====================== */
function handleObjectClick(e){
  const obj = e.currentTarget;
  const type = obj.dataset.type;

  if (type === 'about') { openModal('aboutModal'); return; }

  // proximity gate (except about)
  const a = rect(obj), b = rect(document.getElementById('character'));
  const distance = Math.hypot(a.left - b.left, a.top - b.top);
  if (distance > 150 && type!=='about') {
    showDialogue("I need to get closer to interact with this!", []);
    return;
  }

  if (type==='cv') openModal('cvModal');
  if (type==='social') handleSocialClick(obj.dataset.platform);
  if (type==='fun')   showFunFact(obj.dataset.fact);
}

/* ====================== DIALOGUES/MODALS ====================== */
function showDialogue(text, options=[]){
  gameState.dialogueActive = true;
  document.getElementById('dialogueText').innerHTML = text;
  const opt = document.getElementById('dialogueOptions');
  opt.innerHTML='';
  (options.length?options:[{text:'Close',action:closeDialogue}]).forEach(o=>{
    const b = document.createElement('div');
    b.className='dialogue-option';
    b.textContent=o.text;
    b.onclick=o.action;
    opt.appendChild(b);
  });
  document.getElementById('dialogueBox').classList.add('active');
  hideControls(true);
}
function closeDialogue(){
  gameState.dialogueActive=false;
  document.getElementById('dialogueBox').classList.remove('active');
  hideControls(false);
}
function openModal(id){
  closeDialogue();
  document.getElementById(id).classList.add('active');
  hideControls(true);
}
function closeModal(id){
  document.getElementById(id).classList.remove('active');
  hideControls(false);
}
function closeAllModals(){
  document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'));
  closeDialogue();
}
function showMenu(){
  showDialogue("üéÆ GAME MENU - Navigate Ali's professional world!",[
    {text:"üíª View CV/Resume", action:()=>{closeDialogue();openModal('cvModal');}},
    {text:"üå≥ About Ali",       action:()=>{closeDialogue();openModal('aboutModal');}},
    {text:"üì± Social Profiles", action:()=>{closeDialogue();showDialogue("Choose a profile:",[
      {text:"Instagram", action:()=>{handleSocialClick('instagram');}},
      {text:"TikTok", action:()=>{handleSocialClick('tiktok');}},
      {text:"LinkedIn", action:()=>{handleSocialClick('linkedin');}}
    ])}},
    {text:"Close Menu", action:closeDialogue}
  ]);
}
function showHelp(){
  showDialogue("üéÆ HOW TO PLAY:<br><br>‚Ä¢ Use arrow keys or mobile controls to move<br>‚Ä¢ Click objects when you're close<br>‚Ä¢ üíª Computer = CV/Resume<br>‚Ä¢ ‚ùì Yellow blocks = fun facts<br>‚Ä¢ üå≥ Tree = About Ali<br>‚Ä¢ üì± Icons = My socials<br><br>Collect coins and avoid brown enemies!");
}
function handleSocialClick(platform){
  const urls = {
    instagram:'https://instagram.com/itsalikhaqan',
    tiktok:'https://tiktok.com/@itsalikhaqan',
    linkedin:'https://www.linkedin.com/in/ali-khaqan/'
  };
  showDialogue(`Opening ${platform.toUpperCase()}...`,[
    {text:`Visit ${platform.toUpperCase()}`,action:()=>{window.open(urls[platform],'_blank');closeDialogue();}},
    {text:"Close",action:closeDialogue}
  ]);
}
function hideControls(hide){
  const m = document.getElementById('mobileControls');
  const c = document.getElementById('controlsHelp');
  if (hide){ m.style.display='none'; c.style.visibility='hidden'; }
  else {
    if (window.innerWidth<=768) m.style.display='block';
    c.style.visibility='visible';
  }
}

/* ====================== FUN FACTS ====================== */
function showFunFact(id){
  const facts = {
    "1": "üåç Born in <b>Pakistan</b>; studied and worked across <b>Turkey, Germany, the USA, and India</b> ‚Äî collecting visas like Pok√©mon and projects like side quests.",
    "2": "üèãÔ∏è‚Äç‚ôÇÔ∏è I <b>powerlift</b> and stay unusually calm when things get messy ‚Äî barbells or business. Deep breaths, heavier sets, better decisions."
  };
  showDialogue(facts[id] || "Fun fact coming soon!");
}

/* ====================== COINS & HAZARDS ====================== */
function checkCoinPickup(){
  const coins = Array.from(document.querySelectorAll('.coin'));
  coins.forEach(coin=>{
    if (!coin.dataset.taken && isOverlapById('character', coin)){
      coin.dataset.taken='1';
      coin.style.visibility='hidden';
      gameState.coins++;
      document.getElementById('coinCount').textContent = gameState.coins;
    }
  });
}

// Touching a goomba = lose and restart from start position
function checkHazard(){
  const hazards = Array.from(document.querySelectorAll('.goomba'));
  if (hazards.some(h => isOverlapById('character', h))){
    loseAndRestart();
  }
}
function loseAndRestart(){
  showDialogue("‚ò†Ô∏è Oops! You bumped into a Goomba.<br><br>Restart from the beginning?",[
    {text:"Restart", action:()=>{
      gameState.character.x = START_POS.x;
      gameState.character.y = START_POS.y;
      updateCharacterPosition();
      updateCamera();
      closeDialogue();
    }},
    {text:"Close", action:closeDialogue}
  ]);
}

/* ====================== LOOP ====================== */
function gameLoop(){ updateCharacter(); requestAnimationFrame(gameLoop); }
</script>
</body>
</html>
